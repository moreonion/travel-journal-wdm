/*!
 * Engaging Networks (E-Activist and Netdonor) thermometer plugin for jQuery
 * Copyright (c) 2011 Dave Cranwell (http://davecranwell.com / @davecranwell)
 * Extended 2012 by Adam Lofting (http://adamlofting.com / @adamlofting)
 * Licensed under the MIT License.
 * 2011-09-05
 * version 1.1.1
 */
(function(a){a.fn.eActivistThermometer=function(b){var c={token:"",campaignId:0,target:0,duration:2000,dataUrl:"",initialValue:0,service:"EaEmailAOTarget",currencySymbol:""};function d(e){return Math.max(0,e).toFixed(0).replace(/(?=(?:\d{3})+$)(?!^)/g,",")}return this.each(function(){var e=a(this);if(b){a.extend(c,b)}if(c.dataUrl.length){dataUrl=c.dataUrl}else{dataUrl="http://e-activist.com/ea-dataservice/data.service?service="+c.service+"&resultType=summary&contentType=json&token="+c.token+"&campaignId="+c.campaignId+"&callback=?"}a.get(dataUrl,function(n){if(c.service=="NetDonor"){targetDataColumn="total amount donated"}else{targetDataColumn="registrations"}var l=-1;for(j=0;j<n.rows[0].columns.length;j++){if(n.rows[0].columns[j].name.toLowerCase()==targetDataColumn){l=j}}var o=c.initialValue;for(i=0;i<n.rows.length;i++){o+=parseInt(n.rows[i].columns[l].value)}var h=a(".t_body",e).width();var g=Math.ceil(o/parseInt(c.target)*100/1);if(g>100){g=100}var m=Math.ceil(parseInt(g)/100*h/1);if(m<(h/2)){a(".t_body .t_current",e).removeClass("inner")}else{a(".t_body .t_current",e).addClass("inner")}a(".t_target",e).html(c.currencySymbol+d(c.target));a(".t_current",e).html(c.currencySymbol+d(o)+" ");if(c.duration){var f=1;var k=setInterval(function(){f=parseInt(f)+Math.ceil((o/c.duration)*100);if(f>=o){f=o;clearInterval(k)}a(".t_body .t_current",e).html(c.currencySymbol+d(f))},100);a(".t_level",e).animate({width:g+"%"},c.duration,function(){})}else{a(".t_level",e).css("width",g+"%")}},"json")})}})(jQuery);